(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{494:function(v,_,e){"use strict";e.r(_);var s=e(4),t=Object(s.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("p",[v._v("从输入"),e("code",[v._v("URL")]),v._v("到页面渲染需要"),e("code",[v._v("Chrome")]),v._v("浏览器的多个进程配合，所以我们先来谈谈现阶段"),e("code",[v._v("Chrome")]),v._v("浏览器的多进程架构。")]),v._v(" "),e("h2",{attrs:{id:"一、chrome架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、chrome架构"}},[v._v("#")]),v._v(" 一、"),e("code",[v._v("Chrome")]),v._v("架构")]),v._v(" "),e("p",[v._v("目前"),e("code",[v._v("Chrome")]),v._v("采用的是多进程的架构模式，可分为主要的五类进程，分别是：浏览器（"),e("code",[v._v("Browser")]),v._v("）主进程、 "),e("code",[v._v("GPU")]),v._v(" 进程、网络（"),e("code",[v._v("NetWork")]),v._v("）进程、多个渲染进程和多个插件进程；")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154001110.png",alt:"image-20210311154001110"}})]),v._v(" "),e("p",[e("strong",[v._v("浏览器进程")]),v._v("--主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。")]),v._v(" "),e("p",[e("strong",[v._v("渲染进程")]),v._v("--核心任务是将"),e("code",[v._v("HTML")]),v._v("、"),e("code",[v._v("CSS")]),v._v(" 和 "),e("code",[v._v("JavaScript")]),v._v("转换为用户可以与之交互的网页，排版引擎"),e("code",[v._v("Blink")]),v._v("和"),e("code",[v._v("JavaScript")]),v._v("引擎"),e("code",[v._v("V8")]),v._v("都是运行在该进程中，默认情况下，"),e("code",[v._v("Chrome")]),v._v("会为每个"),e("code",[v._v("Tab")]),v._v("标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。")]),v._v(" "),e("p",[e("strong",[v._v("GPU进程")]),v._v("--其实，"),e("code",[v._v("Chrome")]),v._v("刚开始发布的时候是没有"),e("code",[v._v("GPU")]),v._v("进程的。而"),e("code",[v._v("GPU")]),v._v("的使用初衷是为了实现"),e("code",[v._v("3D CSS")]),v._v("的效果，只是随后网页、"),e("code",[v._v("Chrome")]),v._v("的"),e("code",[v._v("UI")]),v._v("界面都选择采用"),e("code",[v._v("GPU")]),v._v("来绘制，这使得"),e("code",[v._v("GPU")]),v._v("成为浏览器普遍的需求。最后，"),e("code",[v._v("Chrome")]),v._v("在其多进程架构上也引入了"),e("code",[v._v("GPU")]),v._v("进程。")]),v._v(" "),e("p",[e("strong",[v._v("网络进程")]),v._v("--主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。")]),v._v(" "),e("p",[e("strong",[v._v("插件进程")]),v._v("--主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响")]),v._v(" "),e("p",[v._v("了解了"),e("code",[v._v("Chrome")]),v._v("的多进程架构，就能够从宏观上理解从输入"),e("code",[v._v("URL")]),v._v("到页面渲染的过程了，这个过程主要分为"),e("strong",[v._v("导航阶段")]),v._v("和"),e("strong",[v._v("渲染阶段")]),v._v("。")]),v._v(" "),e("h2",{attrs:{id:"二、导航阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、导航阶段"}},[v._v("#")]),v._v(" 二、导航阶段")]),v._v(" "),e("h3",{attrs:{id:"i-浏览器主进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#i-浏览器主进程"}},[v._v("#")]),v._v(" Ⅰ.浏览器主进程")]),v._v(" "),e("h4",{attrs:{id:"_1-用户输入url"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-用户输入url"}},[v._v("#")]),v._v(" 1. 用户输入"),e("code",[v._v("URL")])]),v._v(" "),e("ul",[e("li",[v._v("1、浏览器进程检查"),e("code",[v._v("url")]),v._v("，组装协议，构成完整的"),e("code",[v._v("url")]),v._v("，这时候有两种情况：\n"),e("ul",[e("li",[v._v("输入的是搜索内容：地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的"),e("code",[v._v("URL")]),v._v("。")]),v._v(" "),e("li",[v._v("输入的是请求"),e("code",[v._v("URL")]),v._v("：地址栏会根据规则，给这段内容加上协议，合成为完整的"),e("code",[v._v("URL")]),v._v("；")])])]),v._v(" "),e("li",[v._v("2、浏览器进程通过进程间通信（"),e("code",[v._v("IPC")]),v._v("）把"),e("code",[v._v("url")]),v._v("请求发送给网络进程；")])]),v._v(" "),e("h3",{attrs:{id:"ii-网络进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ii-网络进程"}},[v._v("#")]),v._v(" Ⅱ.网络进程")]),v._v(" "),e("h4",{attrs:{id:"_2-url请求过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-url请求过程"}},[v._v("#")]),v._v(" 2. "),e("code",[v._v("URL")]),v._v("请求过程")]),v._v(" "),e("ul",[e("li",[v._v("3、网络进程接收到"),e("code",[v._v("url")]),v._v("请求后检查本地缓存是否缓存了该请求资源，如果有则将该资源返回给浏览器进程；")])]),v._v(" "),e("blockquote",[e("p",[v._v("这里涉及到浏览器与HTTP协议的缓存策略问题：https://www.cnblogs.com/AhuntSun-blog/p/12529920.html")])]),v._v(" "),e("ul",[e("li",[e("p",[v._v("4、准备"),e("code",[v._v("IP")]),v._v("地址和端口：进行"),e("code",[v._v("DNS")]),v._v("解析时先查找缓存，没有再使用"),e("code",[v._v("DNS")]),v._v("服务器解析，查找顺序为：")])]),v._v(" "),e("li",[e("ul",[e("li",[e("p",[v._v("浏览器缓存；")])]),v._v(" "),e("li",[e("p",[v._v("本机缓存；")])]),v._v(" "),e("li",[e("p",[e("code",[v._v("ISP DNS")]),v._v("缓存；")])])])]),v._v(" "),e("li",[e("ul",[e("li",[e("p",[v._v("根域名解析服务器返回顶级域名服务器")]),v._v(" "),e("ul",[e("li",[e("p",[v._v("顶级域名服务器返回权限域名服务器")])]),v._v(" "),e("li",[e("p",[v._v("权限域名服务器返回域名对应的ip地址给本地解析服务器")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/7/23/1737753b2d71e4c6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:""}})])])])])])]),v._v(" "),e("li",[e("p",[v._v("5、等待"),e("code",[v._v("TCP")]),v._v("队列：浏览器会为每个域名最多维护"),e("code",[v._v("6")]),v._v("个"),e("code",[v._v("TCP")]),v._v("连接，如果发起一个"),e("code",[v._v("HTTP")]),v._v("请求时，这 "),e("code",[v._v("6")]),v._v("个 "),e("code",[v._v("TCP")]),v._v("连接都处于忙碌状态，那么这个请求就会处于排队状态；解决方案：")])]),v._v(" "),e("li",[e("ul",[e("li",[v._v("采用域名分片技术：将一个站点的资源放在多个（"),e("code",[v._v("CDN")]),v._v("）域名下面。")]),v._v(" "),e("li",[v._v("升级为"),e("code",[v._v("HTTP2")]),v._v("，就没有"),e("code",[v._v("6")]),v._v("个"),e("code",[v._v("TCP")]),v._v("连接的限制了；")])])]),v._v(" "),e("li",[e("p",[v._v("6、通过三次握手建立"),e("code",[v._v("TCP")]),v._v("连接：")]),v._v(" "),e("p",[e("strong",[v._v("TCP 报文格式")])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/20180717201939345.jpg",alt:"20180717201939345"}})]),v._v(" "),e("ol",[e("li",[v._v("TCP 报头中的源端口号和目的端口号与 IP 数据报中的源 IP 和目的 IP 唯一确定一条 TCP 连接，TCP 在发送数据前必须在彼此间建立连接")]),v._v(" "),e("li",[v._v("报文主要段的意思：\n"),e("ol",[e("li",[e("code",[v._v("序号(seq)")]),v._v("：表示发送的数据字节流，确保TCP传输有序，对每个字节编号")]),v._v(" "),e("li",[e("code",[v._v("确认号(ack)")]),v._v("：期待收到对方下一个报文段的第一个数据字节的序号，当前报文段最后一个字节的序号加1即为确认号")]),v._v(" "),e("li",[e("code",[v._v("确认(ACK)")]),v._v("：当 ACK = 1时，确认号有效；当 ACK = 0时，确认号无效")]),v._v(" "),e("li",[e("code",[v._v("同步(SYN)")]),v._v("：连接建立请求时同步序号，当 SYN = 1时，表示请求连接")]),v._v(" "),e("li",[e("code",[v._v("终止(FIN)")]),v._v("：用来释放一个连接，当 FIN = 1时，表示此报文段的发送方的数据已经发送完毕，并要求释放连接")])])])]),v._v(" "),e("p",[e("strong",[v._v("三次握手过程")])]),v._v(" "),e("p",[v._v("建立 TCP 连接时，需要客户端和服务端共发送3个包")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/three.png",alt:"img"}})]),v._v(" "),e("ol",[e("li",[v._v("第一次握手：客户端发送请求标志 SYN = 1 和初始序号 seq = x ，请求建立连接，客户端进入 SYN-SENT 状态")]),v._v(" "),e("li",[v._v("第二次握手：服务端发送请求标志 SYN = 1，确认标志 ACK = 1，自己的序号 seq = y，客户端的确认序号 ack = x + 1，服务端进入 SYN-RCVD 状态")]),v._v(" "),e("li",[v._v("第三次握手：客户端发送确认标志 ACK = 1，自己的序号 seq = x + 1，服务端的确认序号 ack = y + 1，发送完毕后，客户端和服务端进入 ESTABLISHED（TCP 连接成功）状态，完成三次握手")])])]),v._v(" "),e("li",[e("p",[e("strong",[v._v("为什么要第三次挥手？"),e("strong",[v._v("避免服务器等待造成")]),v._v("资源浪费")]),v._v("，具体原因：")]),v._v(" "),e("blockquote",[e("p",[v._v("如果没有最后一个数据包确认（第三次握手），"),e("code",[v._v("A")]),v._v("先发出一个建立连接的请求数据包，由于网络原因绕远路了。"),e("code",[v._v("A")]),v._v("经过设定的超时时间后还未收到"),e("code",[v._v("B")]),v._v("的确认数据包。")]),v._v(" "),e("p",[v._v("于是发出第二个建立连接的请求数据包，这次网路通畅，"),e("code",[v._v("B")]),v._v("的确认数据包也很快就到达"),e("code",[v._v("A")]),v._v("。于是"),e("code",[v._v("A")]),v._v("与"),e("code",[v._v("B")]),v._v("开始传输数据；")]),v._v(" "),e("p",[v._v("过了一会"),e("code",[v._v("A")]),v._v("第一次发出的建立连接的请求数据包到达了"),e("code",[v._v("B")]),v._v("，"),e("code",[v._v("B")]),v._v("以为是再次建立连接，所以又发出一个确认数据包。由于A已经收到了一个确认数据包，所以会忽略"),e("code",[v._v("B")]),v._v("发来的第二个确认数据包，但是"),e("code",[v._v("B")]),v._v("发出确认数据包之后就要一直等待"),e("code",[v._v("A")]),v._v("的回复，而"),e("code",[v._v("A")]),v._v("永远也不会回复。")]),v._v(" "),e("p",[v._v("由此造成服务器资源浪费，这种情况多了"),e("code",[v._v("B")]),v._v("计算机可能就停止响应了。")])])]),v._v(" "),e("li",[e("p",[v._v("7、构建并发送"),e("code",[v._v("HTTP")]),v._v("请求信息；")]),v._v(" "),e("p",[e("strong",[v._v("HTTP 请求由请求行、请求头和请求体组成")])]),v._v(" "),e("p",[v._v("请求行由三部分组成，"),e("strong",[v._v("请求方法、请求URL、HTTP协议版本")]),v._v("：")]),v._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token constant"}},[v._v("GET")]),v._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[v._v("HTTP")]),e("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[v._v("1.1")]),v._v("\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("请求头，例如：")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9\nCache-Control: no-cache\nConnection: keep-alive\nCookie: /* 省略cookie信息 */\nHost: www.baidu.com\nPragma: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br"),e("span",{staticClass:"line-number"},[v._v("2")]),e("br"),e("span",{staticClass:"line-number"},[v._v("3")]),e("br"),e("span",{staticClass:"line-number"},[v._v("4")]),e("br"),e("span",{staticClass:"line-number"},[v._v("5")]),e("br"),e("span",{staticClass:"line-number"},[v._v("6")]),e("br"),e("span",{staticClass:"line-number"},[v._v("7")]),e("br"),e("span",{staticClass:"line-number"},[v._v("8")]),e("br"),e("span",{staticClass:"line-number"},[v._v("9")]),e("br"),e("span",{staticClass:"line-number"},[v._v("10")]),e("br")])]),e("p",[v._v("请求体：当请求方法为 "),e("code",[v._v("post")]),v._v(" 时存在")])]),v._v(" "),e("li",[e("p",[v._v("8、服务器端处理请求，返回网络响应；")]),v._v(" "),e("p",[e("strong",[v._v("网络响应由响应行、响应头和响应体组成")])]),v._v(" "),e("p",[e("strong",[v._v("响应行由HTTP协议版本、状态码、状态描述组成")]),v._v("：")]),v._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token constant"}},[v._v("HTTP")]),e("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[v._v("1.1")]),v._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[v._v("200")]),v._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[v._v("OK")]),v._v("\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("响应头包含了服务器及其返回数据的一些信息")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("Cache-Control: no-cache\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Type: text/html;charset=utf-8\nDate: Wed, 04 Dec 2019 12:29:13 GMT\nServer: apache\nSet-Cookie: rsv_i=f9a0SIItKqzv7kqgAAgphbGyRts3RwTg%2FLyU3Y5Eh5LwyfOOrAsvdezbay0QqkDqFZ0DfQXby4wXKT8Au8O7ZT9UuMsBq2k; path=/; domain=.baidu.com\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br"),e("span",{staticClass:"line-number"},[v._v("2")]),e("br"),e("span",{staticClass:"line-number"},[v._v("3")]),e("br"),e("span",{staticClass:"line-number"},[v._v("4")]),e("br"),e("span",{staticClass:"line-number"},[v._v("5")]),e("br"),e("span",{staticClass:"line-number"},[v._v("6")]),e("br"),e("span",{staticClass:"line-number"},[v._v("7")]),e("br")])]),e("p",[v._v("响应体中存放返回的数据")])]),v._v(" "),e("li",[e("p",[v._v("9、客户端处理响应，首先检查服务器响应报文的状态码：")]),v._v(" "),e("ul",[e("li",[v._v("如果是"),e("code",[v._v("301/302")]),v._v("表示服务器已更换域名需要重定向，这时网络进程会从响应头的"),e("code",[v._v("Location")]),v._v("字段里面读取重定向的地址，然后再发起新的"),e("code",[v._v("HTTP")]),v._v("或者"),e("code",[v._v("HTTPS")]),v._v("请求，跳回第"),e("code",[v._v("4")]),v._v("步。")]),v._v(" "),e("li",[v._v("如果是"),e("code",[v._v("304")]),v._v("表示命中协商缓存，浏览器直接从缓存中读取结果。")]),v._v(" "),e("li",[v._v("如果是"),e("code",[v._v("200")]),v._v("，就检查"),e("code",[v._v("Content-Type")]),v._v("字段，值为"),e("code",[v._v("text/html")]),v._v("说明是"),e("code",[v._v("HTML")]),v._v("文档，是"),e("code",[v._v("application/octet-stream")]),v._v("说明是文件下载；")])])])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154045105.png",alt:"image-20210311154045105"}})]),v._v(" "),e("ul",[e("li",[e("p",[v._v("10、请求结束，当通用首部字段"),e("code",[v._v("Conection")]),v._v("不是"),e("code",[v._v("Keep-Alive")]),v._v("时，即不为"),e("code",[v._v("TCP")]),v._v("长连接时，通过四次挥手断开"),e("code",[v._v("TCP")]),v._v("连接：")]),v._v(" "),e("p",[e("strong",[v._v("四次挥手过程")])]),v._v(" "),e("p",[v._v("释放 TCP 连接时，需要客户端和服务端共发送4个包")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/four.png",alt:"img"}})]),v._v(" "),e("ol",[e("li",[v._v("第一次挥手：客户端发送终止标志 FIN = 1，自己的序号 seq = u，客户端进入 FIN-WAIT-1 状态")]),v._v(" "),e("li",[v._v("第二次挥手：服务端接收到客户端的连接释放报文，发送确认标志 ACK = 1，自己的序号 seq = v，客户端的确认号 ack = u + 1，服务端进入 CLOSE-WAIT 状态。这时候处于半关闭状态，客户端已经不再发送数据了，但是服务端若要发送数据，客户端依然要接收")]),v._v(" "),e("li",[v._v("第三次挥手：客户端收到服务端的确认结果后，进入 FIN-WAIT-2 状态。服务端发送 终止标志 FIN = 1，确认标志 ACK = 1，自己的序号 seq = w，客户端的确认号 ack = u + 1，服务端进入 LAST-ACK（最后确认）状态，等待客户端的确认")]),v._v(" "),e("li",[v._v("第四次挥手：客户端接收到服务端的连接释放报文，发送确认标志 ACK = 1，自己的序号 seq = u + 1，服务端的确认号 ack = w + 1，客户端进入 TIME-WAIT（时间等待）状态。客户端必须经过2MSL（报文最大生存事件）后，才能进入 CLOSED 状态。而服务端只要接收到客户端的确认后，立即进入 CLOSED 状态")])]),v._v(" "),e("p",[e("strong",[v._v("为什么连接的时候是三次握手，释放的时候是四次挥手？")])]),v._v(" "),e("ol",[e("li",[v._v("三次握手时，服务端把 SYN 和 ACK 放在一起发送给了客户端")]),v._v(" "),e("li",[v._v("四次挥手时，服务端收到客户端的 FIN 报文时，仅仅表示客户端不再发送数据了但是还能接收数据，必须等到所有的报文都发送完毕了，才能发送 FIN，因此先发一个 ACK 表示已经收到客户端的 FIN，延迟一段时间再发送 FIN")])]),v._v(" "),e("p",[e("strong",[v._v("为什么客户端最后还要等待2MSL？")])]),v._v(" "),e("ul",[e("li",[v._v("客户端需要保证最后一次发送的 ACK 报文到达服务端，如果服务端未收到，可以请求客户端重新发送，这样客户端还有时间重发，重启 2MSL 计时")]),v._v(" "),e("li",[v._v("1 个 MSL 确保四次挥手中主动关闭方最后的 ACK 报文最终能达到对端")]),v._v(" "),e("li",[v._v("1 个 MSL 确保对端没有收到 ACK 重传的 FIN 报文可以到达")])])])]),v._v(" "),e("h4",{attrs:{id:"_3-准备渲染进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-准备渲染进程"}},[v._v("#")]),v._v(" 3. 准备渲染进程")]),v._v(" "),e("ul",[e("li",[v._v("11、准备渲染进程：浏览器进程检查当前"),e("code",[v._v("url")]),v._v("是否与之前打开了渲染进程的页面的根域名相同，如果相同，则复用原来的进程，如果不同，则开启新的渲染进程；")])]),v._v(" "),e("h4",{attrs:{id:"_4-提交文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-提交文档"}},[v._v("#")]),v._v(" 4. 提交文档")]),v._v(" "),e("ul",[e("li",[e("p",[v._v("12、提交文档：")])]),v._v(" "),e("li",[e("ul",[e("li",[e("strong",[v._v("渲染进程")]),v._v("准备好后，"),e("strong",[v._v("浏览器")]),v._v("向"),e("strong",[v._v("渲染进程")]),v._v("发起“"),e("strong",[v._v("提交文档")]),v._v("”的消息，"),e("strong",[v._v("渲染进程")]),v._v("接收到消息后与"),e("strong",[v._v("网络进程")]),v._v("建立传输数据的“"),e("strong",[v._v("管道")]),v._v("”")]),v._v(" "),e("li",[e("strong",[v._v("渲染进程")]),v._v("接收完数据后，向浏览器发送“"),e("strong",[v._v("确认提交")]),v._v("”")]),v._v(" "),e("li",[e("strong",[v._v("浏览器进程")]),v._v("接收到确认消息后更新浏览器界面状态："),e("strong",[v._v("安全状态")]),v._v("、"),e("strong",[v._v("地址栏"),e("code",[v._v("url")])]),v._v("、"),e("strong",[v._v("前进后退的历史状态")]),v._v("、"),e("strong",[v._v("更新"),e("code",[v._v("web")]),v._v("页面")])])])])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154126491.png",alt:"image-20210311154126491"}})]),v._v(" "),e("h2",{attrs:{id:"三、渲染阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、渲染阶段"}},[v._v("#")]),v._v(" 三、渲染阶段")]),v._v(" "),e("p",[v._v("在渲染阶段通过"),e("strong",[v._v("渲染流水线")]),v._v("在渲染进程的主线程和合成线程配合下，完成页面的渲染；")]),v._v(" "),e("h3",{attrs:{id:"iii-渲染进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iii-渲染进程"}},[v._v("#")]),v._v(" Ⅲ.渲染进程")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154142453.png",alt:"image-20210311154142453"}})]),v._v(" "),e("blockquote",[e("p",[v._v("渲染进程中的主线程部分")])]),v._v(" "),e("h4",{attrs:{id:"_5-构建dom树"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-构建dom树"}},[v._v("#")]),v._v(" 5. 构建"),e("code",[v._v("DOM")]),v._v("树")]),v._v(" "),e("ul",[e("li",[e("p",[v._v("13、先将请求回来的数据解压，随后"),e("code",[v._v("HTML")]),v._v("解析器将其中的"),e("code",[v._v("HTML")]),e("strong",[v._v("字节流")]),v._v("通过"),e("strong",[v._v("分词器")]),v._v("拆分为一个个"),e("code",[v._v("Token")]),v._v("，然后生成节点"),e("code",[v._v("Node")]),v._v("，最后解析成浏览器识别的"),e("code",[v._v("DOM")]),v._v("树结构。")]),v._v(" "),e("p",[v._v("可以通过"),e("code",[v._v("Chrome")]),v._v("调试工具的"),e("code",[v._v("Console")]),v._v("选项打开控制台输入"),e("code",[v._v("document")]),v._v("查看"),e("code",[v._v("DOM")]),v._v("树；")])])]),v._v(" "),e("blockquote",[e("p",[v._v("渲染引擎还有一个"),e("strong",[v._v("安全检查模块")]),v._v("叫 "),e("code",[v._v("XSSAuditor")]),v._v("，是用来"),e("strong",[v._v("检测词法安全")]),v._v("的。在分词器解析出来 "),e("code",[v._v("Token")]),v._v(" 之后，它会检测这些模块是否安全，比如"),e("strong",[v._v("是否引用了外部脚本")]),v._v("，"),e("strong",[v._v("是否符合 "),e("code",[v._v("CSP")]),v._v(" 规范")]),v._v("，"),e("strong",[v._v("是否存在跨站点请求")]),v._v("等。如果出现不符合规范的内容，"),e("code",[v._v("XSSAuditor")]),v._v(" 会对该脚本或者下载任务"),e("strong",[v._v("进行拦截")]),v._v("。")])]),v._v(" "),e("p",[v._v("首次解析"),e("code",[v._v("HTML")]),v._v("时"),e("strong",[v._v("渲染进程")]),v._v("会开启一个"),e("strong",[v._v("预解析线程")]),v._v("，遇到"),e("code",[v._v("HTML")]),v._v("文档中内嵌的"),e("code",[v._v("JavaScript")]),v._v("和"),e("code",[v._v("CSS")]),v._v("外部引用就会同步提前下载这些文件，下载时间以最后下载完的文件为准。")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154155513.png",alt:"image-20210311154155513"}})]),v._v(" "),e("h4",{attrs:{id:"_6-构建cssom"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-构建cssom"}},[v._v("#")]),v._v(" 6. 构建"),e("code",[v._v("CSSOM")])]),v._v(" "),e("ul",[e("li",[e("p",[v._v("14、"),e("code",[v._v("CSS")]),v._v("解析器将"),e("code",[v._v("CSS")]),v._v("转换为浏览器能识别的"),e("code",[v._v("styleSheets")]),v._v("也就是"),e("code",[v._v("CSSOM")]),v._v("：可以通过控制台输入"),e("code",[v._v("document.styleSheets")]),v._v("查看；")]),v._v(" "),e("p",[v._v("这里要考虑一下阻塞的问题，由于"),e("code",[v._v("JavaScript")]),v._v("有修改"),e("code",[v._v("CSS")]),v._v("和"),e("code",[v._v("HTML")]),v._v("的能力，所以，需要先等到 "),e("code",[v._v("CSS")]),v._v(" 文件下载完成并生成 "),e("code",[v._v("CSSOM")]),v._v("，然后再执行 "),e("code",[v._v("JavaScript")]),v._v(" 脚本，最后再继续构建 "),e("code",[v._v("DOM")]),v._v("。由于这种阻塞，导致了"),e("strong",[v._v("解析白屏")]),v._v("；")])])]),v._v(" "),e("blockquote",[e("p",[e("strong",[v._v("优化方案：")])]),v._v(" "),e("ol",[e("li",[e("p",[e("strong",[v._v("移除"),e("code",[v._v("js")]),v._v("和"),e("code",[v._v("css")]),v._v("的文件下载")]),v._v("：通过内联 "),e("code",[v._v("JavaScript")]),v._v("、内联 "),e("code",[v._v("CSS")]),v._v("；")])]),v._v(" "),e("li",[e("p",[e("strong",[v._v("尽量减少文件大小")]),v._v("：如通过 "),e("code",[v._v("webpack")]),v._v(" 等工具"),e("strong",[v._v("移除")]),v._v("不必要的"),e("strong",[v._v("注释")]),v._v("，并"),e("strong",[v._v("压缩 "),e("code",[v._v("js")]),v._v(" 文件")]),v._v("；")])]),v._v(" "),e("li",[e("p",[v._v("将不进行"),e("code",[v._v("DOM")]),v._v("操作或"),e("code",[v._v("CSS")]),v._v("样式修改的 "),e("code",[v._v("JavaScript")]),v._v(" 标记上 "),e("code",[v._v("async")]),v._v(" 或者 "),e("code",[v._v("defer")]),v._v("异步引入；")])]),v._v(" "),e("li",[e("p",[e("strong",[v._v("使用媒体查询属性")]),v._v("：将大的"),e("code",[v._v("CSS")]),v._v("文件拆分成多个不同用途的 "),e("code",[v._v("CSS")]),v._v(" 文件，只有在特定的场景下才会加载特定的 "),e("code",[v._v("CSS")]),v._v(" 文件。")])])])]),v._v(" "),e("p",[v._v("可以通过浏览器调试工具的"),e("code",[v._v("Network")]),v._v("面板中的"),e("code",[v._v("DOMContentLoaded")]),v._v("查看最后生成"),e("code",[v._v("DOM")]),v._v("树所需的时间；")]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154209061.png",alt:"image-20210311154209061"}})]),v._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"图片"}})]),v._v(" "),e("h4",{attrs:{id:"_7-样式计算"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-样式计算"}},[v._v("#")]),v._v(" 7. 样式计算")]),v._v(" "),e("ul",[e("li",[v._v("15、转换样式表中的属性值，使其标准化。如"),e("code",[v._v("em")]),v._v("->"),e("code",[v._v("px")]),v._v(","),e("code",[v._v("red")]),v._v("->"),e("code",[v._v("#ff0000")]),v._v(","),e("code",[v._v("bold")]),v._v("->"),e("code",[v._v("700")]),v._v("等等;")]),v._v(" "),e("li",[v._v("16、计算"),e("code",[v._v("DOM")]),v._v("树中每个节点的具体样式，这里遵循"),e("code",[v._v("CSS")]),v._v("的"),e("strong",[v._v("继承")]),v._v("和"),e("strong",[v._v("层叠")]),v._v("规则；可以通过"),e("code",[v._v("Chrome")]),v._v("调试工具的"),e("code",[v._v("Elements")]),v._v("选项的"),e("code",[v._v("Computed")]),v._v("查看某一标签的最终样式；")])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154231182.png",alt:"image-20210311154231182"}})]),v._v(" "),e("h4",{attrs:{id:"_8-布局阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-布局阶段"}},[v._v("#")]),v._v(" 8. 布局阶段")]),v._v(" "),e("ul",[e("li",[v._v("17、创建布局树，遍历"),e("code",[v._v("DOM")]),v._v("树中的所有节点，去掉所有隐藏的节点（比如"),e("code",[v._v("head")]),v._v("，添加了"),e("code",[v._v("display:none")]),v._v("的节点），只在布局树中保留可见的节点。")]),v._v(" "),e("li",[v._v("18、计算布局树中节点的坐标位置（较复杂，这里不展开）；")])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://sanyuan0704.top/my_blog/week10/3.jpg",alt:""}})]),v._v(" "),e("h4",{attrs:{id:"_9-分层"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-分层"}},[v._v("#")]),v._v(" 9. 分层")]),v._v(" "),e("ul",[e("li",[v._v("19、对布局树进行分层，并生成分层树（"),e("code",[v._v("Layer Tree")]),v._v("），可以通过"),e("code",[v._v("Chrome")]),v._v("调试工具的"),e("code",[v._v("Layer")]),v._v("选项查看。分层树中每一个节点都直接或间接的属于一个图层（如果一个节点没有对应的层，那么这个节点就从属于父节点的图层）")])]),v._v(" "),e("h4",{attrs:{id:"_10-图层绘制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-图层绘制"}},[v._v("#")]),v._v(" 10. 图层绘制")]),v._v(" "),e("ul",[e("li",[v._v("20、将图层的绘制拆分成一个个绘制指令，然后将这些指令按顺序组合成一个绘制列表。")])]),v._v(" "),e("blockquote",[e("p",[e("strong",[v._v("渲染进程中的合成线程部分")])])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154314452.png",alt:"image-20210311154314452"}})]),v._v(" "),e("h4",{attrs:{id:"_11-切分图块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-切分图块"}},[v._v("#")]),v._v(" 11. 切分图块")]),v._v(" "),e("ul",[e("li",[v._v("21、合成线程将图层切分成大小固定的图块（"),e("code",[v._v("256x256")]),v._v("或者"),e("code",[v._v("512x512")]),v._v("）然后"),e("strong",[v._v("优先绘制")]),v._v("靠近视口的图块，这样就可以大大加速页面的显示速度；")])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154357772.png",alt:"image-20210311154357772"}})]),v._v(" "),e("h3",{attrs:{id:"iv-gpu进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iv-gpu进程"}},[v._v("#")]),v._v(" "),e("strong",[v._v("Ⅳ.GPU进程")])]),v._v(" "),e("h4",{attrs:{id:"_12-栅格化操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_12-栅格化操作"}},[v._v("#")]),v._v(" 12. 栅格化操作")]),v._v(" "),e("ul",[e("li",[v._v("22、在"),e("strong",[v._v("光栅化线程池")]),v._v("中将"),e("strong",[v._v("图块")]),v._v("转换成"),e("strong",[v._v("位图")]),v._v("，通常这个过程都会使用"),e("code",[v._v("GPU")]),v._v("来加速生成，使用"),e("code",[v._v("GPU")]),v._v("生成位图的过程叫"),e("strong",[v._v("快速栅格化")]),v._v("，或者"),e("code",[v._v("GPU")]),v._v("栅格化，生成的位图被保存在"),e("code",[v._v("GPU")]),v._v("内存中。")])]),v._v(" "),e("p",[e("img",{attrs:{src:"https://blogimg2020.oss-cn-shenzhen.aliyuncs.com/blogimg/image-20210311154421134.png",alt:"image-20210311154421134"}})]),v._v(" "),e("h3",{attrs:{id:"v-浏览器主进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v-浏览器主进程"}},[v._v("#")]),v._v(" Ⅴ.浏览器主进程")]),v._v(" "),e("h4",{attrs:{id:"_13-合成与显示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_13-合成与显示"}},[v._v("#")]),v._v(" 13. 合成与显示")]),v._v(" "),e("ul",[e("li",[v._v("23、合成：一旦所有图块都被光栅化，"),e("strong",[v._v("合成线程")]),v._v("就会将它们合成为一张图片，并生成一个绘制图块的命令——“"),e("code",[v._v("DrawQuad")]),v._v("”，然后将该命令提交给浏览器进程。")])]),v._v(" "),e("blockquote",[e("p",[e("strong",[v._v("注意了："),e("strong",[v._v("合成的过程是在渲染进程的")]),v._v("合成线程")]),v._v("中完成的，不会影响到渲染进程的"),e("strong",[v._v("主线程")]),v._v("执行；")])]),v._v(" "),e("ul",[e("li",[v._v("24、显示：浏览器进程里面有一个叫"),e("code",[v._v("viz")]),v._v("的组件，用来接收合成线程发过来的"),e("code",[v._v("DrawQuad")]),v._v("命令，然后根据"),e("code",[v._v("DrawQuad")]),v._v("命令，将其页面内容绘制到内存中，最后再将内存显示在屏幕上。")])]),v._v(" "),e("p",[v._v("到这里，经过这一系列的阶段，编写好的"),e("code",[v._v("HTML")]),v._v("、"),e("code",[v._v("CSS")]),v._v("、"),e("code",[v._v("JavaScript")]),v._v("等文件，经过浏览器就会显示出漂亮的页面了。")])])}),[],!1,null,null,null);_.default=t.exports}}]);